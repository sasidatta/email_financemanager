<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transaction Handler</title>
</head>
<body>
    <h1>Email Transaction Management</h1>
    
    <!-- Buttons to trigger fetch and cleanup operations -->
    <form method="get" action="/fetch-emails" style="display:inline;">
        <button type="submit">Fetch Emails</button>
    </form>
    <form method="post" action="/cleanup-emails" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete all emails?');">
        <button type="submit">Cleanup Emails</button>
    </form>
    
    <!-- Category filter -->
    <form method="get" action="/transactions" style="display:inline; margin-left:20px;">
        <label for="category">Filter by Category:</label>
        <select name="category" id="category" onchange="this.form.submit()">
            <option value="">All</option>
            {% for cat in categories %}
                <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
    </form>
    
    <!-- Section to display status messages -->
    <pre id="result"></pre>
    
    <!-- Transactions table -->
    <table id="transactions-table" border="1" cellpadding="5" cellspacing="0">
        <thead>
            <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Merchant</th>
                <th>Transaction Type</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody>
            {% if transactions %}
                {% for txn in transactions %}
                <tr>
                    <td>{{ txn.date }}</td>
                    <td>{{ txn.amount }}</td>
                    <td>{{ txn.merchant_name }}</td>
                    <td>{{ txn.transactiontype }}</td>
                    <td>{{ txn.category }}</td>
                </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="5">No transactions found.</td></tr>
            {% endif %}
        </tbody>
    </table>
</body>
</html>